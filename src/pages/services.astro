---
import BaseLayout from '../layouts/BaseLayout.astro';
import Button from '../components/button.astro';
import Card from '../components/card.astro';
import { sanityClient, urlFor } from '../lib/sanity';
import Schema from '../components/schema.astro';

// Fetch products from Sanity (with fallback data)
let products;
let siteSettings;

try {
  products = await sanityClient.fetch('*[_type == "product"] | order(order asc)');
  siteSettings = await sanityClient.fetch('*[_type == "siteSettings"][0]');
} catch (error) {
  console.log('Using fallback content (Sanity not connected yet)');
}

// Use fallback for missing data
if (!products) {
  console.log('⚠️ No product documents found in Sanity - using fallback product catalog');
}

if (!siteSettings) {
  console.log('⚠️ No siteSettings document found in Sanity - using fallback phone/whatsapp settings');
  siteSettings = {
    phone: "053-5227619",
    whatsapp: "972535227619"
  };
}

if (!products) {
  
  products = [
    {
      name: "פיגום אלומיניום סטנדרטי גובה דריכה 6.3 מ",
      manufacturer: "GIERRE SCALE איטליה",
      maxHeight: "6.3 מ",
      workingHeight: "8.3 מ", 
      maxWeight: "168 ק״ג",
      platformSize: "135X63 ס״מ",
      warranty: "10 שנות אחריות",
      standard: "תקן אירופאי EN1004",
      image: null,
      featured: true,
      price: "לבירור"
    },
    {
      name: "פיגום סטנדרטי גובה דריכה 4.6 מ",
      manufacturer: "GIERRE SCALE איטליה", 
      maxHeight: "4.6 מ",
      workingHeight: "6.6 מ",
      maxWeight: "168 ק״ג", 
      platformSize: "135X63 ס״מ",
      warranty: null,
      standard: "תקן אירופאי EN1004",
      image: null,
      featured: false,
      price: "לבירור"
    },
    {
      name: "פיגום אלומיניום מקצועי גובה דריכה 4 מ – רוחב כפול",
      manufacturer: "NORD TECHNOLOGIES",
      maxHeight: "4.4 מ", 
      workingHeight: "6.4 מ",
      maxWeight: "250 ק״ג",
      platformSize: "135X200 ס״מ", 
      warranty: "5 שנות אחריות",
      standard: "תקן אירופאי EN1004",
      image: null,
      featured: true,
      price: "לבירור"
    }
  ];
  
  siteSettings = {
    phone: "053-5227619",
    whatsapp: "972535227619"
  };
}
---

<BaseLayout 
  title="קטלוג פיגומים ניידים | GIERRE SCALE איטליה | השכרה בבית שמש"
  description="קטלוג מלא של פיגומים ניידים איכותיים: 6.3 מ, 4.6 מ ורוחב כפול. יצרן GIERRE SCALE איטליה, תקן EN1004. השכרה בבית שמש ☎️ 053-527-7619"
  keywords="קטלוג פיגומים, GIERRE SCALE, פיגום 6.3 מטר, פיגום אלומיניום, השכרת ציוד בנייה, בית שמש"
>
  <!-- Schema.org structured data -->
  <Schema type="breadcrumb" data={[
    {name: "עמוד הבית", url: "https://pigumim.netlify.app/"},
    {name: "שירותים", url: "https://pigumim.netlify.app/services"}
  ]} slot="head" />
  
  {products?.map((product: any) => (
    <Schema type="product" data={product} slot="head" />
  ))}
  
  <!-- Header Section -->
  <section class="bg-gradient-to-br from-primary-50 via-white to-blue-50 py-16">
    <div class="container mx-auto px-4">
      <div class="text-center max-w-4xl mx-auto">
        <h1 class="text-4xl md:text-6xl font-bold mb-6 leading-tight text-gray-900">
          השירותים שלנו
        </h1>
        <p class="text-xl md:text-2xl leading-relaxed text-gray-700 mb-8">
          פיגומים ניידים מקצועיים לכל צורך - בטיחות, איכות ושירות ללא פשרות
        </p>
      </div>
    </div>
  </section>

  <!-- Products Grid -->
  <section class="py-20 bg-white">
    <div class="container mx-auto px-4">
      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
        {products?.map((product: any) => (
          <Card class={`relative overflow-hidden flex flex-col h-full ${product.featured ? 'ring-2 ring-secondary-400' : ''}`}>
            {product.featured && (
              <div class="absolute top-4 right-4 bg-secondary-500 text-white px-3 py-1 rounded-full text-sm font-semibold z-10">
                מומלץ
              </div>
            )}
            
            {product.image ? (
              <img 
                src={urlFor(product.image).width(400).height(200).url()} 
                alt={product.name} 
                class="w-full h-48 object-cover mb-6 rounded-lg"
              />
            ) : (
              <div class="w-full h-48 bg-gradient-to-br from-primary-100 to-primary-200 rounded-lg mb-6 flex items-center justify-center">
                <svg class="w-16 h-16 text-primary-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                </svg>
              </div>
            )}
            
            <!-- Content that grows to fill space -->
            <div class="flex-grow">
              <h3 class="text-xl font-bold text-gray-900 mb-4 leading-tight">
                {product.name}
              </h3>
              
              <div class="space-y-3 text-sm">
                <div class="flex justify-between">
                  <span class="text-gray-600">יצרן:</span>
                  <span class="font-semibold text-gray-900">{product.manufacturer}</span>
                </div>
                
                <div class="flex justify-between">
                  <span class="text-gray-600">גובה דריכה:</span>
                  <span class="font-semibold text-primary-700">{product.maxHeight}</span>
                </div>
                
                <div class="flex justify-between">
                  <span class="text-gray-600">גובה עבודה:</span>
                  <span class="font-semibold text-gray-900">{product.workingHeight}</span>
                </div>
                
                <div class="flex justify-between">
                  <span class="text-gray-600">משקל מותר:</span>
                  <span class="font-semibold text-gray-900">{product.maxWeight}</span>
                </div>
                
                <div class="flex justify-between">
                  <span class="text-gray-600">גודל במה:</span>
                  <span class="font-semibold text-gray-900">{product.platformSize}</span>
                </div>
                
                {product.warranty && (
                  <div class="flex justify-between">
                    <span class="text-gray-600">אחריות:</span>
                    <span class="font-semibold text-green-600">{product.warranty}</span>
                  </div>
                )}
                
                <div class="flex justify-between">
                  <span class="text-gray-600">תקן:</span>
                  <span class="font-semibold text-gray-900">{product.standard}</span>
                </div>
              </div>
            </div>
            
            <!-- Button always at bottom -->
            <div class="mt-6 pt-6 border-t border-gray-200">
              <div class="flex items-center justify-between mb-4">
                <span class="text-gray-600">מחיר:</span>
                <span class="text-lg font-bold text-secondary-600">{product.price}</span>
              </div>
              
              <div class="flex gap-2">
                <Button 
                  href={`tel:+972${siteSettings.phone?.replace(/^0/, '').replace(/-/g, '')}`}
                  variant="secondary"
                  class="flex-1"
                >
                  📞 התקשר
                </Button>
                <Button 
                  href={`https://wa.me/${siteSettings.whatsapp}?text=${encodeURIComponent(`שלום, אני מעוניין לקבל הצעת מחיר עבור ${product.name}. אודה לפרטים נוספים.`)}`}
                  variant="outline"
                  class="flex-1"
                >
                  💬 WhatsApp
                </Button>
              </div>
            </div>
          </Card>
        ))}
      </div>
    </div>
  </section>

  <!-- CTA Section -->
  <section class="py-20 bg-gradient-to-br from-gray-50 via-blue-50 to-primary-50">
    <div class="container mx-auto px-4 text-center">
      <h2 class="text-3xl md:text-4xl font-bold mb-8 text-gray-900">
        מעוניינים בהצעת מחיר?
      </h2>
      <p class="text-xl mb-8 text-gray-700 max-w-2xl mx-auto">
        התקשרו אלינו עכשיו לקבלת יעוץ מקצועי והצעת מחיר מותאמת אישית
      </p>
      
      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <Button 
          href={`tel:+972${siteSettings.phone?.replace(/^0/, '').replace(/-/g, '')}`}
          variant="secondary"
          size="lg"
        >
          📞 {siteSettings.phone}
        </Button>
        <Button 
          href={`https://wa.me/${siteSettings.whatsapp}?text=${encodeURIComponent('שלום, אני מעוניין לקבל יעוץ מקצועי והצעת מחיר מותאמת אישית לפיגומים ניידים. אודה לפרטים נוספים.')}`}
          variant="outline"
          size="lg"
        >
          💬 WhatsApp
        </Button>
      </div>
      
      <p class="mt-6 text-lg text-gray-600">
        <strong>דבר עם חיים להצעת מחיר משתלמת</strong>
      </p>
    </div>
  </section>

</BaseLayout>